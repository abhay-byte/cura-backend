# CURA Project - Database Schema Documentation

This document outlines the database schema for all models used in the CURA project.

---

## 1. `users` App

This app manages user authentication and core user data.

### Model: `CustomUser`

Inherits from Django's `AbstractUser` and stores user account information.

| Field Name   | Data Type     | Description                                      |
|--------------|----------------|--------------------------------------------------|
| id           | AutoField       | Primary Key.                                    |
| username     | CharField       | The user's unique username.                     |
| email        | EmailField      | The user's unique email address. Used for login.|
| password     | CharField       | Hashed password for the user.                   |
| first_name   | CharField       | User's first name (optional).                   |
| last_name    | CharField       | User's last name (optional).                    |
| is_staff     | BooleanField    | Designates if the user can access the admin site.|
| is_active    | BooleanField    | Designates if the user account is active.       |
| date_joined  | DateTimeField   | The date and time the user account was created. |

---

## 2. `reminder_agent` App

This app manages medicines and medication reminders.

### Model: `Medicine`

Stores information about a specific medicine belonging to a user.

| Field Name       | Data Type          | Description                                                  |
|------------------|--------------------|--------------------------------------------------------------|
| id               | AutoField          | Primary Key.                                                 |
| user             | ForeignKey (User)  | A many-to-one relationship to the `CustomUser` model.       |
| name             | CharField          | The name of the medicine (e.g., "Paracetamol").              |
| dosage           | CharField          | The dosage strength (e.g., "500mg").                         |
| inventory        | PositiveIntegerField | The current quantity in stock (e.g., 50 pills).             |
| refill_threshold | PositiveIntegerField | Level at which to trigger a refill reminder.               |
| created_at       | DateTimeField      | The date and time the medicine was added.                    |

### Model: `Reminder`

Stores the schedule for taking a specific medicine.

| Field Name     | Data Type           | Description                                                  |
|----------------|---------------------|--------------------------------------------------------------|
| id             | AutoField           | Primary Key.                                                 |
| medicine       | ForeignKey (Medicine)| A many-to-one relationship to the `Medicine` model.         |
| reminder_time  | TimeField           | The specific time to take the medicine (e.g., "09:00").      |
| quantity       | PositiveIntegerField| Number of units to take at the scheduled time.               |
| instruction    | CharField (Choices) | Instructions (e.g., "After Food", "Before Food").            |
| is_active      | BooleanField        | Whether the reminder is currently active.                    |
| last_notified  | DateTimeField       | Last time a notification was sent (optional).                |

---

## 3. `diet_agent` App

This app manages user health profiles and personalized diet plans.

### Model: `UserProfile`

Stores detailed health and lifestyle information for a user.

| Field Name          | Data Type            | Description                                                 |
|---------------------|----------------------|-------------------------------------------------------------|
| id                  | AutoField            | Primary Key.                                                |
| user                | OneToOneField (User) | A one-to-one relationship to the `CustomUser` model.        |
| age                 | PositiveIntegerField | The user's age in years.                                    |
| weight_kg           | FloatField           | The user's weight in kilograms.                             |
| height_cm           | FloatField           | The user's height in centimeters.                           |
| activity_level      | CharField            | The user's general activity level (e.g., "Sedentary").      |
| dietary_preferences | CharField            | The user's dietary choices (e.g., "Vegan").                 |
| allergies           | TextField            | Known allergies (e.g., "Peanuts, Shellfish").               |
| health_issues       | TextField            | Relevant health conditions (e.g., "Diabetes").              |

### Model: `DietPlan`

Stores the diet plans generated by the agent for a user.

| Field Name   | Data Type         | Description                                                  |
|--------------|-------------------|--------------------------------------------------------------|
| id           | AutoField         | Primary Key.                                                 |
| user         | ForeignKey (User) | A many-to-one relationship to the `CustomUser` model.        |
| plan_details | JSONField         | A JSON object containing the structured diet plan.           |
| created_at   | DateTimeField     | The date and time the diet plan was generated.               |
| is_active    | BooleanField      | Designates if this is the user's current active diet plan.   |

---
## 4. JSON Structures

This section details the structure of complex JSON objects used within the project, including `JSONField` contents and API request bodies.

### **4.1 `DietPlan.plan_details` Field**

This is the complete schema for the JSON object stored in the `plan_details` field of the `DietPlan` model.

```json
{
  "daily_calories": 2150, // Integer: Total estimated calories for the day.
  "macronutrients": { // Object: Estimated macronutrient split.
    "protein_grams": 150, // Integer: Grams of protein.
    "carbs_grams": 200,   // Integer: Grams of carbohydrates.
    "fat_grams": 80       // Integer: Grams of fat.
  },
  "meals": { // Object: Contains details for each meal of the day.
    "breakfast": { // Object: Details for the breakfast meal.
      "name": "Greek Yogurt with Almonds and Berries", // String: Name of the dish.
      "time": "08:00", // String (HH:MM): Suggested time for the meal.
      "calories": 400, // Integer: Estimated calories for this meal.
      "notes": "A great source of protein to start your day." // String: Optional notes or tips.
    },
    "lunch": { // Object: Details for the lunch meal.
      "name": "Quinoa Salad with Chickpeas and Avocado",
      "time": "13:00",
      "calories": 650,
      "notes": "Rich in fiber and healthy fats."
    },
    "snack": { // Object: Details for a snack (optional).
      "name": "Apple with Peanut Butter",
      "time": "16:00",
      "calories": 250,
      "notes": ""
    },
    "dinner": { // Object: Details for the dinner meal.
      "name": "Baked Salmon with Asparagus and Sweet Potato",
      "time": "19:30",
      "calories": 850,
      "notes": "Excellent source of Omega-3 fatty acids."
    }
  },
  "grocery_list": [ // Array of Strings: A list of ingredients needed for the plan.
    "Greek Yogurt",
    "Almonds",
    "Mixed Berries",
    "Quinoa",
    "Chickpeas",
    "Avocado",
    "Apple",
    "Peanut Butter",
    "Salmon Fillet",
    "Asparagus",
    "Sweet Potato"
  ],
  "notes": "Remember to drink at least 8 glasses of water throughout the day." // String: General notes for the entire day's plan.
}
```

4.2 API Request Payloads

This section describes the JSON bodies for key API endpoints.
User Profile (POST /api/diet/profile/)

```json
{
  "age": 35, // Integer: User's age in years.
  "weight_kg": 80.5, // Number: User's weight in kilograms.
  "height_cm": 182, // Number: User's height in centimeters.
  "activity_level": "Moderately Active", // String: One of ["Sedentary", "Lightly Active", "Moderately Active", "Very Active"].
  "dietary_preferences": "Non-Veg", // String: One of ["Non-Veg", "Vegetarian", "Vegan", "Pescatarian"].
  "allergies": "Shellfish", // String: Comma-separated list of allergies.
  "health_issues": "Wants a heart-healthy diet to manage cholesterol." // String: Description of health goals or conditions.
}
```
Add Medicine (POST /api/reminder/medicines/)

```json
{
  "name": "Aspirin", // String: Name of the medicine.
  "dosage": "100mg", // String: Dosage strength.
  "inventory": 100 // Integer: Initial quantity in stock.
}
```
Add Reminder (POST /api/reminder/medicines/{id}/reminders/)

```json
{
  "time": "08:30", // String (HH:MM): Time for the reminder.
  "quantity": 2, // Integer: Number of units to take.
  "instruction": "Before Food" // String: One of ["Before Food", "After Food", "With Food", "Any Time"].
}
```
